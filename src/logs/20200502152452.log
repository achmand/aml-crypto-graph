INFO: 2020-05-02 15:24:52 
-------- START EXPERIMENT --------
INFO: 2020-05-02 15:24:52 
- PROPERTIES -
INFO: 2020-05-02 15:24:52 
{'cat_boost_args': {'persist_props': {'method': 'save',
                                      'save_path': 'persistence/experiment_1/tuned_models'},
                    'tune_props': {'k_folds': 5,
                                   'method': 'tpe',
                                   'n_iterations': 50,
                                   'param_grid': {'bootstrap_type': {'type': 'fixed',
                                                                     'value': 'MVS'},
                                                  'depth': {'max': 10,
                                                            'min': 4,
                                                            'step': 1,
                                                            'type': 'suggest_int'},
                                                  'eval_metric': {'type': 'fixed',
                                                                  'value': 'F1'},
                                                  'iterations': {'type': 'throw',
                                                                 'value': 5000},
                                                  'l2_leaf_reg': {'max': 10.0,
                                                                  'min': 1.0,
                                                                  'type': 'suggest_loguniform'},
                                                  'leaf_estimation_iterations': {'max': 10,
                                                                                 'min': 1,
                                                                                 'step': 1,
                                                                                 'type': 'suggest_int'},
                                                  'learning_rate': {'max': 1.0,
                                                                    'min': 0.00091188196,
                                                                    'type': 'suggest_loguniform'},
                                                  'random_strength': {'max': 20,
                                                                      'min': 1,
                                                                      'step': 1,
                                                                      'type': 'suggest_int'},
                                                  'rsm': {'max': 1.0,
                                                          'min': 0.0,
                                                          'step': 0.0025,
                                                          'type': 'suggest_discrete_uniform'},
                                                  'subsample': {'max': 1.0,
                                                                'min': 0.5,
                                                                'type': 'suggest_uniform'},
                                                  'thread_count': {'type': 'throw',
                                                                   'value': 16},
                                                  'verbose': {'type': 'fixed',
                                                              'value': 0}},
                                   'scoring': 'f1',
                                   'stratify_shuffle': True}},
 'data': 'elliptic',
 'data_config_file': 'configuration/data/data_config.yaml',
 'elliptic_args': {'encode_classes': True,
                   'feat_sets': ['AF_NE'],
                   'inc_unknown': False,
                   'train_size': 0.7},
 'evaluation_metrics': ['precision',
                        'recall',
                        'f1_micro',
                        'accuracy',
                        'auc',
                        'confusion',
                        'f1'],
 'light_boost_args': {'persist_props': {'method': 'save',
                                        'save_path': 'persistence/experiment_1/tuned_models'},
                      'tune_props': {'k_folds': 5,
                                     'method': 'tpe',
                                     'n_iterations': 50,
                                     'param_grid': {'colsample_bytree': {'max': 1.0,
                                                                         'min': 0.5,
                                                                         'type': 'suggest_uniform'},
                                                    'learning_rate': {'max': 1.0,
                                                                      'min': 0.00091188196,
                                                                      'type': 'suggest_loguniform'},
                                                    'min_child_samples': {'max': 400,
                                                                          'min': 1,
                                                                          'type': 'suggest_int'},
                                                    'min_child_weight': {'max': 148.413159103,
                                                                         'min': 1.12535175e-07,
                                                                         'type': 'suggest_loguniform'},
                                                    'n_estimators': {'type': 'throw',
                                                                     'value': 5000},
                                                    'n_jobs': {'type': 'throw',
                                                               'value': 16},
                                                    'num_leaves': {'max': 1000,
                                                                   'min': 1,
                                                                   'type': 'suggest_int'},
                                                    'reg_alpha': {'max': 7.38905609893,
                                                                  'min': 1.12535175e-07,
                                                                  'type': 'suggest_loguniform'},
                                                    'reg_lambda': {'max': 7.38905609893,
                                                                   'min': 1.12535175e-07,
                                                                   'type': 'suggest_loguniform'},
                                                    'subsample': {'max': 1.0,
                                                                  'min': 0.5,
                                                                  'type': 'suggest_uniform'},
                                                    'subsample_freq': {'type': 'fixed',
                                                                       'value': 1}},
                                     'scoring': 'f1',
                                     'stratify_shuffle': True}},
 'log_path': 'logs/',
 'models': ['xg_boost', 'light_boost', 'cat_boost'],
 'save_log': True,
 'xg_boost_args': {'persist_props': {'method': 'save',
                                     'save_path': 'persistence/experiment_1/tuned_models'},
                   'tune_props': {'k_folds': 5,
                                  'method': 'tpe',
                                  'n_iterations': 50,
                                  'param_grid': {'colsample_bylevel': {'max': 1.0,
                                                                       'min': 0.5,
                                                                       'type': 'suggest_uniform'},
                                                 'colsample_bytree': {'max': 1.0,
                                                                      'min': 0.5,
                                                                      'type': 'suggest_uniform'},
                                                 'gamma': {'max': 7.38905609893,
                                                           'min': 1.12535175e-07,
                                                           'type': 'suggest_loguniform'},
                                                 'learning_rate': {'max': 1.0,
                                                                   'min': 0.00091188196,
                                                                   'type': 'suggest_loguniform'},
                                                 'max_depth': {'max': 10,
                                                               'min': 2,
                                                               'step': 1,
                                                               'type': 'suggest_int'},
                                                 'min_child_weight': {'max': 148.413159103,
                                                                      'min': 1.12535175e-07,
                                                                      'type': 'suggest_loguniform'},
                                                 'n_estimators': {'type': 'throw',
                                                                  'value': 5000},
                                                 'n_jobs': {'type': 'throw',
                                                            'value': 16},
                                                 'reg_alpha': {'max': 7.38905609893,
                                                               'min': 1.12535175e-07,
                                                               'type': 'suggest_loguniform'},
                                                 'reg_lambda': {'max': 7.38905609893,
                                                                'min': 1.12535175e-07,
                                                                'type': 'suggest_loguniform'},
                                                 'subsample': {'max': 1.0,
                                                               'min': 0.5,
                                                               'type': 'suggest_uniform'}},
                                  'scoring': 'f1',
                                  'stratify_shuffle': True}}}
INFO: 2020-05-02 15:24:52 
--- START BUILDING DATASET ---
INFO: 2020-05-02 15:24:52 
- DATASET -
INFO: 2020-05-02 15:24:52 
elliptic
INFO: 2020-05-02 15:24:52 
- CONFIG -
INFO: 2020-05-02 15:24:52 
'configuration/data/data_config.yaml'
INFO: 2020-05-02 15:24:59 
--- FINISH BUILDING DATASET ---
INFO: 2020-05-02 15:24:59 
--- START BUILDING MODELS ---
INFO: 2020-05-02 15:24:59 
- MODELS -
INFO: 2020-05-02 15:24:59 
['xg_boost', 'light_boost', 'cat_boost']
INFO: 2020-05-02 15:24:59 
[START BUILDING MODEL 'xg_boost']
INFO: 2020-05-02 15:24:59 
- ARGUMENTS -
INFO: 2020-05-02 15:24:59 
{'persist_props': {'method': 'save',
                   'save_path': 'persistence/experiment_1/tuned_models'},
 'tune_props': {'k_folds': 5,
                'method': 'tpe',
                'n_iterations': 50,
                'param_grid': {'colsample_bylevel': {'max': 1.0,
                                                     'min': 0.5,
                                                     'type': 'suggest_uniform'},
                               'colsample_bytree': {'max': 1.0,
                                                    'min': 0.5,
                                                    'type': 'suggest_uniform'},
                               'gamma': {'max': 7.38905609893,
                                         'min': 1.12535175e-07,
                                         'type': 'suggest_loguniform'},
                               'learning_rate': {'max': 1.0,
                                                 'min': 0.00091188196,
                                                 'type': 'suggest_loguniform'},
                               'max_depth': {'max': 10,
                                             'min': 2,
                                             'step': 1,
                                             'type': 'suggest_int'},
                               'min_child_weight': {'max': 148.413159103,
                                                    'min': 1.12535175e-07,
                                                    'type': 'suggest_loguniform'},
                               'n_estimators': {'type': 'throw', 'value': 5000},
                               'n_jobs': {'type': 'throw', 'value': 16},
                               'reg_alpha': {'max': 7.38905609893,
                                             'min': 1.12535175e-07,
                                             'type': 'suggest_loguniform'},
                               'reg_lambda': {'max': 7.38905609893,
                                              'min': 1.12535175e-07,
                                              'type': 'suggest_loguniform'},
                               'subsample': {'max': 1.0,
                                             'min': 0.5,
                                             'type': 'suggest_uniform'}},
                'scoring': 'f1',
                'stratify_shuffle': True}}
INFO: 2020-05-02 15:24:59 
----> [START BUILDING 'xg_boost' MODEL FOR 'AF_NE' FEATURE SET]
INFO: 2020-05-02 15:24:59 
----> [FINISH BUILDING 'xg_boost' MODEL FOR 'AF_NE' FEATURE SET]
INFO: 2020-05-02 15:24:59 
[FINISH BUILDING MODEL 'xg_boost']
INFO: 2020-05-02 15:24:59 
[START BUILDING MODEL 'light_boost']
INFO: 2020-05-02 15:24:59 
- ARGUMENTS -
INFO: 2020-05-02 15:24:59 
{'persist_props': {'method': 'save',
                   'save_path': 'persistence/experiment_1/tuned_models'},
 'tune_props': {'k_folds': 5,
                'method': 'tpe',
                'n_iterations': 50,
                'param_grid': {'colsample_bytree': {'max': 1.0,
                                                    'min': 0.5,
                                                    'type': 'suggest_uniform'},
                               'learning_rate': {'max': 1.0,
                                                 'min': 0.00091188196,
                                                 'type': 'suggest_loguniform'},
                               'min_child_samples': {'max': 400,
                                                     'min': 1,
                                                     'type': 'suggest_int'},
                               'min_child_weight': {'max': 148.413159103,
                                                    'min': 1.12535175e-07,
                                                    'type': 'suggest_loguniform'},
                               'n_estimators': {'type': 'throw', 'value': 5000},
                               'n_jobs': {'type': 'throw', 'value': 16},
                               'num_leaves': {'max': 1000,
                                              'min': 1,
                                              'type': 'suggest_int'},
                               'reg_alpha': {'max': 7.38905609893,
                                             'min': 1.12535175e-07,
                                             'type': 'suggest_loguniform'},
                               'reg_lambda': {'max': 7.38905609893,
                                              'min': 1.12535175e-07,
                                              'type': 'suggest_loguniform'},
                               'subsample': {'max': 1.0,
                                             'min': 0.5,
                                             'type': 'suggest_uniform'},
                               'subsample_freq': {'type': 'fixed', 'value': 1}},
                'scoring': 'f1',
                'stratify_shuffle': True}}
INFO: 2020-05-02 15:24:59 
----> [START BUILDING 'light_boost' MODEL FOR 'AF_NE' FEATURE SET]
INFO: 2020-05-02 15:24:59 
----> [FINISH BUILDING 'light_boost' MODEL FOR 'AF_NE' FEATURE SET]
INFO: 2020-05-02 15:24:59 
[FINISH BUILDING MODEL 'light_boost']
INFO: 2020-05-02 15:24:59 
[START BUILDING MODEL 'cat_boost']
INFO: 2020-05-02 15:24:59 
- ARGUMENTS -
INFO: 2020-05-02 15:24:59 
{'persist_props': {'method': 'save',
                   'save_path': 'persistence/experiment_1/tuned_models'},
 'tune_props': {'k_folds': 5,
                'method': 'tpe',
                'n_iterations': 50,
                'param_grid': {'bootstrap_type': {'type': 'fixed',
                                                  'value': 'MVS'},
                               'depth': {'max': 10,
                                         'min': 4,
                                         'step': 1,
                                         'type': 'suggest_int'},
                               'eval_metric': {'type': 'fixed', 'value': 'F1'},
                               'iterations': {'type': 'throw', 'value': 5000},
                               'l2_leaf_reg': {'max': 10.0,
                                               'min': 1.0,
                                               'type': 'suggest_loguniform'},
                               'leaf_estimation_iterations': {'max': 10,
                                                              'min': 1,
                                                              'step': 1,
                                                              'type': 'suggest_int'},
                               'learning_rate': {'max': 1.0,
                                                 'min': 0.00091188196,
                                                 'type': 'suggest_loguniform'},
                               'random_strength': {'max': 20,
                                                   'min': 1,
                                                   'step': 1,
                                                   'type': 'suggest_int'},
                               'rsm': {'max': 1.0,
                                       'min': 0.0,
                                       'step': 0.0025,
                                       'type': 'suggest_discrete_uniform'},
                               'subsample': {'max': 1.0,
                                             'min': 0.5,
                                             'type': 'suggest_uniform'},
                               'thread_count': {'type': 'throw', 'value': 16},
                               'verbose': {'type': 'fixed', 'value': 0}},
                'scoring': 'f1',
                'stratify_shuffle': True}}
INFO: 2020-05-02 15:24:59 
----> [START BUILDING 'cat_boost' MODEL FOR 'AF_NE' FEATURE SET]
INFO: 2020-05-02 15:24:59 
----> [FINISH BUILDING 'cat_boost' MODEL FOR 'AF_NE' FEATURE SET]
INFO: 2020-05-02 15:24:59 
[FINISH BUILDING MODEL 'cat_boost']
INFO: 2020-05-02 15:24:59 
--- FINISH BUILDING MODELS ---
INFO: 2020-05-02 15:24:59 
--- START TRAINING ---
INFO: 2020-05-02 15:24:59 
[START TRAINING MODEL 'xg_boost']
INFO: 2020-05-02 15:24:59 
----> [START TRAINING 'xg_boost' MODEL FOR 'AF_NE' FEATURE SET]
INFO: 2020-05-02 23:44:06 
- MODEL PARAMS -
INFO: 2020-05-02 23:44:06 
{'base_score': 0.5,
 'booster': None,
 'colsample_bylevel': 0.662579769175881,
 'colsample_bynode': 1,
 'colsample_bytree': 0.8625494671828154,
 'gamma': 0.0002974922404499394,
 'gpu_id': -1,
 'importance_type': 'gain',
 'interaction_constraints': None,
 'learning_rate': 0.07425551644920138,
 'max_delta_step': 0,
 'max_depth': 3,
 'min_child_weight': 5.725233439812487e-05,
 'missing': nan,
 'monotone_constraints': None,
 'n_estimators': 2561,
 'n_jobs': 0,
 'num_parallel_tree': 1,
 'objective': 'binary:logistic',
 'random_state': 0,
 'reg_alpha': 3.440356098019968e-06,
 'reg_lambda': 0.009046739391051883,
 'scale_pos_weight': 1,
 'subsample': 0.8456188891447396,
 'tree_method': None,
 'validate_parameters': False,
 'verbosity': None}
INFO: 2020-05-02 23:44:06 
----> [FINISH TRAINING 'xg_boost' MODEL FOR 'AF_NE' FEATURE SET]
INFO: 2020-05-02 23:44:06 
[FINISH TRAINING MODEL 'xg_boost']
INFO: 2020-05-02 23:44:06 
[START TRAINING MODEL 'light_boost']
INFO: 2020-05-02 23:44:06 
----> [START TRAINING 'light_boost' MODEL FOR 'AF_NE' FEATURE SET]
ERROR: 2020-05-03 00:14:13 
(<class 'lightgbm.basic.LightGBMError'>, LightGBMError('Check failed: num_leaves >1 at /__w/1/s/python-package/compile/src/io/config_auto.cpp, line 304 .\n'), <traceback object at 0x7f5d599d42d0>)
Traceback (most recent call last):
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/engine.py", line 228, in train
    booster = Booster(params=params, train_set=train_set)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/basic.py", line 1714, in __init__
    train_set.construct().handle,
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/basic.py", line 1085, in construct
    categorical_feature=self.categorical_feature, params=self.params)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/basic.py", line 887, in _lazy_init
    self.__init_from_np2d(data, params_str, ref_dataset)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/basic.py", line 937, in __init_from_np2d
    ctypes.byref(self.handle)))
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/basic.py", line 45, in _safe_call
    raise LightGBMError(decode_string(_LIB.LGBM_GetLastError()))
lightgbm.basic.LightGBMError: Check failed: num_leaves >1 at /__w/1/s/python-package/compile/src/io/config_auto.cpp, line 304 .


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "model_tuner.py", line 208, in <module>
    train_models(dataset, models)
  File "model_tuner.py", line 137, in train_models
    model.fit(X, y)
  File "/home/dvassallo/repos/aml-crypto-graph/src/cryptoaml/models/_models.py", line 116, in fit
    self._tuner, self._tune_props = tu.tune_model(self._model, X, y, self._tune_props)
  File "/home/dvassallo/repos/aml-crypto-graph/src/cryptoaml/tune/_tuning.py", line 666, in tune_model
    tuner.fit(X, y)
  File "/home/dvassallo/repos/aml-crypto-graph/src/cryptoaml/tune/_tuning.py", line 352, in fit
    self._study.optimize(self._objective, n_trials=self._n_iterations)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/optuna/study.py", line 331, in optimize
    func, n_trials, timeout, catch, callbacks, gc_after_trial, None
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/optuna/study.py", line 626, in _optimize_sequential
    self._run_trial_and_callbacks(func, catch, callbacks, gc_after_trial)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/optuna/study.py", line 656, in _run_trial_and_callbacks
    trial = self._run_trial(func, catch, gc_after_trial)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/optuna/study.py", line 677, in _run_trial
    result = func(trial)
  File "/home/dvassallo/repos/aml-crypto-graph/src/cryptoaml/tune/_tuning.py", line 308, in _objective
    tmp_estimator.fit(**fit_props)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/sklearn.py", line 805, in fit
    callbacks=callbacks)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/sklearn.py", line 600, in fit
    callbacks=callbacks)
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/engine.py", line 234, in train
    train_set._reverse_update_params()
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/basic.py", line 1181, in _reverse_update_params
    _safe_call(_LIB.LGBM_DatasetUpdateParam(self.handle, c_str(param_dict_to_str(self.params))))
  File "/home/dvassallo/anaconda3/envs/btc-classifier/lib/python3.7/site-packages/lightgbm/basic.py", line 45, in _safe_call
    raise LightGBMError(decode_string(_LIB.LGBM_GetLastError()))
lightgbm.basic.LightGBMError: Check failed: num_leaves >1 at /__w/1/s/python-package/compile/src/io/config_auto.cpp, line 304 .

